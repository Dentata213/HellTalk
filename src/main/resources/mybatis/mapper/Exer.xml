<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mybatis.mapper.Exer">

	<!-- 운동부위 조회 -->
	<select id="selectExerciseKindList" parameterType="Map" resultType="ExerciseDTO">
		SELECT * FROM exercisekind
	</select>
	
	<!-- 운동 전체 조회 -->
	<select id="selectExerciseList" parameterType="Map" resultType="ExerciseDTO">
		select * FROM exercise e JOIN exercisekind ek ON e.ek_no=ek.ek_no ORDER BY e_no
	</select>
	
	<!-- 운동부위 no에 따른 운동 조회 -->
	<select id="selectExerciseListByKind" parameterType="Map" resultType="ExerciseDTO">
		select e.* FROM exercise e JOIN exercisekind ek ON e.ek_no=ek.ek_no WHERE ek.ek_no=${ek_no}
	</select>
	
	
	<!-- <insert id="insertExerciseRoutine" parameterType="Map">
		<selectKey order="BEFORE" resultType="int" keyProperty="rout_no">
			SELECT SEQ_routine.NEXTVAL FROM DUAL
		</selectKey>
		
		INSERT into routine VALUES(SEQ_routine.CURRVAL,#{u_no},#{rout_name},#{rout_content},#{rout_level},#{rout_effect},#{rout_gender},#{rout_time},#{rout_mode},#{start},#{end},#{rout_display},#{day1},#{day2},#{day3},#{day4},#{day5},#{day6},#{day7})
	</insert> -->
	
	<insert id="insertExerciseRoutine" parameterType="Map">
		<selectKey keyProperty="calcno" resultType="int" order="BEFORE">
		SELECT SEQ_CALCNO.NEXTVAL FROM DUAL
		</selectKey>
		  INSERT ALL	  
		  INTO ROUTINE
		  values(SEQ_routine.NEXTVAL,(SELECT DISTINCT users.U_no FROM users WHERE u_email=#{u_email}),#{rout_name},#{rout_content},#{rout_level},#{rout_effect},#{rout_gender},#{rout_time},#{rout_mode},#{start},#{end},#{rout_display},#{day1},#{day2},#{day3},#{day4},#{day5},#{day6},#{day7})
		  INTO CALCHECK 
		  VALUES(SEQ_CALCNO.NEXTVAL,
		  (SELECT DISTINCT users.U_no FROM users WHERE u_email=#{u_email}), 
		  SEQ_routine.NEXTVAL,'#F06595','N') 
		  SELECT * FROM DUAL
	</insert>
	
	<!-- 추천 운동 루틴 전체 조회 -->
	<select id="selectExerciseRoutine" parameterType="Map" resultType="ExerciseDTO">
		SELECT r.*,u_nickname,u_gender FROM routine r JOIN users u ON r.u_no=u.u_no WHERE rout_display='Y'
	</select>
	
</mapper>
